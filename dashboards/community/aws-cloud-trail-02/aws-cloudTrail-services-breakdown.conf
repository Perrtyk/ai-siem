{
    "graphs": [
        {
            "graphStyle": "stacked_bar",
            "query": "dataSource.name='CloudTrail' dataSource.category = 'security'\n| filter NOT isempty(src_endpoint.uid)\n| group count = count() by src_endpoint.uid, activity_name\n| transpose src_endpoint.uid",
            "title": "Activity by Endpoint",
            "xAxis": "grouped_data",
            "yScale": "logarithmic",
            "layout": {
                "h": 20,
                "w": 30,
                "x": 0,
                "y": 20
            },
            "barWidth": "auto"
        },
        {
            "dataLabelType": "PERCENTAGE",
            "graphStyle": "pie",
            "maxPieSlices": 30,
            "query": "dataSource.name='CloudTrail' | group count() by cloud.region ",
            "title": "Cloud Regions",
            "totalNumberConfig": {},
            "layout": {
                "h": 20,
                "w": 20,
                "x": 0,
                "y": 0
            }
        },
        {
            "graphStyle": "number",
            "query": "dataSource.name='CloudTrail' \n| group count = estimate_distinct(actor.user.type)",
            "sparklineConfig": {
                "enabled": false
            },
            "title": "User Types",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            },
            "layout": {
                "h": 5,
                "w": 10,
                "x": 20,
                "y": 0
            }
        },
        {
            "graphStyle": "",
            "query": "dataSource.name='CloudTrail' \n| group count = count() by actor.user.type",
            "showBarsColumn": "false",
            "title": "Activity by User Type",
            "layout": {
                "h": 15,
                "w": 20,
                "x": 20,
                "y": 5
            }
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 5,
                "w": 10,
                "x": 40,
                "y": 0
            },
            "query": "dataSource.name='CloudTrail' src_endpoint.uid = *\n| group count = estimate_distinct(src_endpoint.uid)",
            "sparklineConfig": {
                "enabled": false
            },
            "title": "Endpoints",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        },
        {
            "graphStyle": "stacked_bar",
            "query": "dataSource.name='CloudTrail' dataSource.category = 'security' dataSource.category = 'security'\n| filter NOT isempty(src_endpoint.uid)\n| group count = count() by src_endpoint.uid, activity_name\n| transpose activity_name",
            "title": "Service Activity Comparison",
            "xAxis": "grouped_data",
            "yScale": "logarithmic",
            "layout": {
                "h": 20,
                "w": 30,
                "x": 30,
                "y": 20
            }
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 5,
                "w": 10,
                "x": 30,
                "y": 0
            },
            "query": "dataSource.name='CloudTrail' \n| group count = estimate_distinct(actor.user.uid)",
            "sparklineConfig": {
                "enabled": false
            },
            "title": "Unique UID",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        },
        {
            "graphStyle": "",
            "layout": {
                "h": 15,
                "w": 20,
                "x": 40,
                "y": 5
            },
            "query": "dataSource.name='CloudTrail' \n| let user_uid_5 = (actor.user.type == 'AWSService') ? rtrim(http_request.user_agent, \".amazonaws.com\" ): 'null'\n| parse \"[A-Z0-9]+:$user_uid_4$\" from actor.user.uid\n| let user_uid_3 = ( user_uid_5 == 'null' ) ? user_uid_4 : user_uid_5\n| let user_uid_2 = (user_uid_3 contains:anycase 'botocore') ? 'botocore-session' : user_uid_3\n| let user_uid_1 = (isempty(user_uid_2)) ? actor.user.uid : user_uid_2\n| let user_uid = (user_uid_1 contains:anycase 'Trusted') ? 'TrustedAdvisor' : user_uid_1\n| group count = count() by user_uid\n| sort - count",
            "showBarsColumn": "false",
            "title": "Activity by Identity"
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 5,
                "i": "8",
                "minH": 3,
                "minW": 6,
                "w": 10,
                "x": 50,
                "y": 0
            },
            "query": "dataSource.name='CloudTrail' cloud.region = *\n| group count = estimate_distinct(cloud.region)",
            "sparklineConfig": {
                "enabled": false
            },
            "title": "Regions",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        }
    ],
    "filters": [
        {
            "facet": "api.service.name",
            "name": "Service Name"
        },
        {
            "facet": "actor.user.type",
            "name": "User Type"
        }
    ],
    "description": "Track user logins, actions, and privilege escalations"
}