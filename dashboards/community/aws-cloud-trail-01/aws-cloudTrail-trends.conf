{
    "graphs": [
        {
            "graphStyle": "donut",
            "maxPieSlices": 30,
            "query": "dataSource.name='CloudTrail' api.service.name = * dataSource.category = 'security' \n| parse \"$api_service_name{regex=\\\\w+}$.+\" from api.service.name \n| group count = count() by api_service_name\n| sort - count\n| limit 20",
            "title": "Top 20 Active Services",
            "layout": {
                "h": 20,
                "w": 20,
                "x": 0,
                "y": 20
            },
            "dataLabelType": "PERCENTAGE",
            "totalNumberConfig": {
                "enabled": false
            }
        },
        {
            "graphStyle": "stacked_bar",
            "query": "| join \ndatagram = (\n  dataSource.name='CloudTrail' api.service.name = * \n  | parse \"$api_service_name{regex=\\\\w+}$.+\" from api.service.name \n  | group count = count() by api_service_name, timestamp = timebucket()\n),\ntop_20 = (\n  dataSource.name='CloudTrail' api.service.name = * \n  | parse \"$api_service_name{regex=\\\\w+}$.+\" from api.service.name \n  | group count = count() by api_service_name\n  | sort - count\n  | limit 20\n) on api_service_name\n| columns api_service_name, timestamp, datagram.count\n| transpose api_service_name",
            "title": "Top 20 Active Services Histogram",
            "xAxis": "time",
            "yScale": "linear",
            "barWidth": "auto",
            "layout": {
                "h": 20,
                "w": 40,
                "x": 20,
                "y": 20
            }
        },
        {
            "colorScheme": "green",
            "colorSchemeOrder": "standard",
            "graphStyle": "heatmap",
            "heatmapRangeConfig": [
                "-∞",
                "",
                "",
                "",
                "",
                "∞"
            ],
            "linkConfig": {
                "template": "/dashboards/SIEMPOC%20-%20AWS%20CloudTrail%20-%20Services%20Breakdown?_categoryId=dashboards&filter=api.service.name+contains%3Aanycase+%27{{COLUMN_NAME}}%27 "
            },
            "numberOfRanges": 5,
            "query": "| join \ndatagram = (\n  dataSource.name='CloudTrail' api.service.name = * \n  | parse \"$api_service_name{regex=\\\\w+}$.+\" from api.service.name \n  | group count = count() by api_service_name, timestamp = timebucket()\n),\ntop_20 = (\n  dataSource.name='CloudTrail' api.service.name = * \n  | parse \"$api_service_name{regex=\\\\w+}$.+\" from api.service.name \n  | group count = count() by api_service_name\n  | sort - count\n  | limit 20\n) on api_service_name\n| columns api_service_name, timestamp, datagram.count\n| transpose api_service_name",
            "rangesCreation": "automatic",
            "title": "Top 20 Services Activity Over time",
            "layout": {
                "h": 20,
                "i": "2",
                "minH": 3,
                "minW": 6,
                "w": 40,
                "x": 0,
                "y": 0
            }
        },
        {
            "graphStyle": "number",
            "query": "dataSource.name='CloudTrail'\n| group services = array_agg_distinct(api.service.name)\n| let count = len(services)\n| columns count",
            "sparklineConfig": {
                "enabled": true
            },
            "title": "Number of Services",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            },
            "layout": {
                "h": 10,
                "w": 10,
                "x": 40,
                "y": 0
            }
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 10,
                "w": 10,
                "x": 50,
                "y": 0
            },
            "query": "dataSource.name='CloudTrail'\n| group regions = array_agg_distinct(cloud.region)\n| let count = len(regions)\n| columns count",
            "sparklineConfig": {
                "enabled": true
            },
            "title": "Number of Regions",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 10,
                "w": 10,
                "x": 40,
                "y": 10
            },
            "query": "dataSource.name='CloudTrail'\n| group activities = array_agg_distinct(activity_name)\n| let count = len(activities)\n| columns count",
            "sparklineConfig": {
                "enabled": true
            },
            "title": "Distinct Activities",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        },
        {
            "graphStyle": "number",
            "layout": {
                "h": 10,
                "w": 10,
                "x": 50,
                "y": 10
            },
            "query": "dataSource.name='CloudTrail'\n| group roles = array_agg_distinct(unmapped.requestParameters.roleName)\n| let count = len(roles)\n| columns count",
            "sparklineConfig": {
                "enabled": true
            },
            "title": "Unique IAM Roles",
            "trendConfig": {
                "enabled": true,
                "indicators": {
                    "arrow": {
                        "enabled": true
                    },
                    "number": {
                        "calculationType": "ABSOLUTE",
                        "enabled": true
                    },
                    "upwardsMeaning": "POSITIVE"
                }
            }
        },
        {
            "graphStyle": "line",
            "lineSmoothing": "smoothCurves",
            "query": "dataSource.name='CloudTrail' api.service.name = * dataSource.category = 'security'\n| group services = array_agg_distinct(api.service.name) by timestamp = timebucket()\n| let count = len(services)\n| let average = overall_avg(count)\n| columns timestamp, count, average\n| compare last_week = timeshift('1w')",
            "title": "Service Activity Variance",
            "yScale": "logarithmic",
            "layout": {
                "h": 14,
                "i": "7",
                "minH": 3,
                "minW": 6,
                "w": 30,
                "x": 0,
                "y": 40
            }
        },
        {
            "graphStyle": "line",
            "lineSmoothing": "straightLines",
            "query": "dataSource.name='CloudTrail' api.service.name = * dataSource.category = 'security' dataSource.category = 'security'\n| group services = array_agg_distinct(api.service.name) by timestamp = timebucket('30m')\n| let count = len(services)\n| columns timestamp, count\n| let sampleCount = overall_count()\n| let mean = overall_avg(count)\n| let pofc = pow(count - mean, 2)\n| let sumofp = overall_sum(pofc)\n| let stdDev = sqrt(sumofp/sampleCount)\n| columns timestamp, count, mean, stdDev\n| let l_1σ = mean - stdDev, u_1σ = mean + stdDev\n| columns timestamp, count, mean, l_1σ, u_1σ",
            "title": "Service Normal Distribution",
            "yScale": "linear",
            "layout": {
                "h": 14,
                "i": "8",
                "minH": 3,
                "minW": 6,
                "w": 20,
                "x": 30,
                "y": 40
            }
        },
        {
            "graphStyle": "markdown",
            "markdown": "The middle line is the average in the distribution for the count of Service API activities. The **1σ range** is your **normal fluctuation** for the time period.\n\n---\n\nMath in plain English:\n\nThe **1σ range** is where most of the Service API counts in half-hour periods fall. About **two-thirds of all readings** land somewhere between **lower 1σ  and upper 1σ **\n\nThis is the \u201Ctypical\u201D range where the bulk of the Service API activities sit.\n\n \n",
            "title": "Normal Distribution",
            "layout": {
                "h": 14,
                "i": "9",
                "minH": 3,
                "minW": 6,
                "w": 10,
                "x": 50,
                "y": 40
            }
        }
    ],
    "description": "Highlights CloutTrail Services"
}